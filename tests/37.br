import "external/abyss";

// switching on patterns

variant OptI32 {
    Some(i32 value),
    None,
}

fn get_int_if_ready() -> OptI32 {
    if abyss..is_ready() {
        return OptI32..Some(abyss..get_val());
    }
    return OptI32..None;
}

variant Opt<T> {
    Some(T value),
    None,
}

fn get_if_ready<T>() -> Opt<T> {
    if abyss..is_ready::<T>() {
        return Opt..Some::<T>(abyss..get_val::<T>());
    }
    return Opt..None;
}

fn main() -> i32 {
    var foo = get_int_if_ready::<i32>();
    if foo == 42 {
        return 42;
    }
    // exhaustive, to be checked at comptime
    return switch(get_int_if_ready()) {
        OptI32..Some(var x) => x,
        OptI32..None => 42,
    };
}
